
<script type="text/javascript">
    RED.nodes.registerType('wws-webhook',{
        category: 'Watson Work',
        color:"#11ABA5",
        defaults: {
            account: {
                type: "wws-credentials",
                required: true
            },
            webhookSecret: {
                value: "", 
                required: true
            },
            webhookPath: {
                value: "/workspace/hook", 
                required: true
            },
            filterOutputs: {
                value: false,
                required: false
            },
            o_messageCreated : {
                value: false,
                required: false
            },
            o_messageEdited : {
                value: false,
                required: false
            },
            o_messageDeleted : {
                value: false,
                required: false
            },
            o_spaceMemberRemoved : {
                value: false,
                required: false
            },
            o_spaceMemberAdded : {
                value: false,
                required: false
            },
            o_spaceUpdated : {
                value: false,
                required: false
            },
            o_spaceDeleted : {
                value: false,
                required: false
            },
            o_annotationAdded : {
                value: false,
                required: false
            },
            o_annotationEdited : {
                value: false,
                required: false
            },
            o_annotationRemoved : {
                value: false,
                required: false
            },
            o_reactionAdded : {
                value: false,
                required: false
            },
            o_reactionRemoved : {
                value: false,
                required: false
            },
            hidden_string : {
                value : "",
                required : false
            },
            cacheLimit : {
                value : 5000,
                validate : RED.validators.number(),
                required : true
            },
            noOwnAnnotations : {
                value : true,
                required : true
            },
            name: {
                value : ""
            },
            outputs: {
                //
                //  this is the same "outputs" variable that is used to define the number of outputs of the node instance
                //  It is promoted here in order to make sure it can be programmatically modified
                //
                value : 1
            }
        },
        credentials: {
            webhookSecret: {
                type: "text"
            }
        },
        inputs: 0,
        outputs: 1,
        icon: "wws.png",
        outputLabels: function(index) { 
            //
            //  This function dynamically assigns a label to each of the output.
            //  The label assigned to each output reflects the value entered in the wwsActionsList input
            //  An additional label is generated for the last output, to cover the "OTHERWISE" case
            //
            var temp = this.hidden_string.split(',');
            return temp[index].trim();
        },
        label: function() {
            if (this.name) {
                return this.name;
            } else {
                return "["+this.webhookPath+"] webhook";
            }
        },
        paletteLabel: "webhook",
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: _setupWebhookNode,
        oneditsave : _saveWebhookNode
    });


    function _setupWebhookNode() {
        _filterOutputsWebhookNode();
    }

    function _saveWebhookNode() {
        if (document.querySelector("#node-input-filterOutputs").checked){ 
            let count = 0;
            let out = [];

            if (document.querySelector("#node-input-o_messageCreated").checked) {count += 1; out.push("message-created")};
            if (document.querySelector("#node-input-o_messageEdited").checked) {count += 1; out.push("message-edited")};
            if (document.querySelector("#node-input-o_messageDeleted").checked)  {count += 1; out.push("message-deleted")};
            if (document.querySelector("#node-input-o_annotationAdded").checked)  {count += 1; out.push("message-annotation-added")};
            if (document.querySelector("#node-input-o_annotationEdited").checked)  {count += 1; out.push("message-annotation-edited")};
            if (document.querySelector("#node-input-o_annotationRemoved").checked)  {count += 1; out.push("message-annotation-removed")};
            if (document.querySelector("#node-input-o_spaceMemberAdded").checked)  {count += 1; out.push("space-members-added")};
            if (document.querySelector("#node-input-o_spaceMemberRemoved").checked)  {count += 1; out.push("space-members-removed")};
            if (document.querySelector("#node-input-o_spaceUpdated").checked)  {count += 1; out.push("space-updated")};
            if (document.querySelector("#node-input-o_spaceDeleted").checked)  {count += 1; out.push("space-deleted")};
            if (document.querySelector("#node-input-o_reactionAdded").checked)  {count += 1; out.push("reaction-added")};
            if (document.querySelector("#node-input-o_reactionRemoved").checked)  {count += 1; out.push("reaction-removed")};
            this.outputs = count;
            this.hidden_string = out.join(',');
        } else { 
            this.outputs = 1;
            this.hidden_string = "output";
        } 

    }

    function _filterOutputsWebhookNode() { 
        if (document.querySelector("#node-input-filterOutputs").checked){ 
            document.querySelector("#outputDetails").style.display = "inline"; 
        } else { 
            document.querySelector("#outputDetails").style.display = "none"; 
        } 
    }
    
</script>

<script type="text/x-red" data-template-name="wws-webhook">
    <div class="form-row">
        <label for="node-input-account"><i class="fa fa-user"></i> App Name</label>
        <input type="text" id="node-input-account">
    </div>
    <div class="form-row">
        <label for="node-input-webhookSecret"><i class="fa fa-user-secret"></i> Hook Secret</label>
        <input type="password" id="node-input-webhookSecret" autocomplete="off">
    </div>
    <div class="form-row">
        <label for="node-input-webhookPath"><i class="fa fa-cog"></i> Hook Path</label>
        <input type="text" id="node-input-webhookPath">
    </div>


    <div class="form-row">
        <label for="node-input-filterOutputs"><i></i> Filter Outputs ?</label>
        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="limitCB" id="node-input-filterOutputs" onchange="_filterOutputsWebhookNode()"></input>
    </div>
    <div class="form-row" id="outputDetails">
        <table style="width: 100%">
            <tr>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_messageCreated"><i></i> Message Created</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual1" id="node-input-o_messageCreated"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_messageEdited"><i></i> Message Edited</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual2" id="node-input-o_messageEdited"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_messageDeleted"><i></i> Message Deleted</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual3" id="node-input-o_messageDeleted"></input>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_annotationAdded"><i></i> Annotation Added</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual4" id="node-input-o_annotationAdded"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_annotationEdited"><i></i> Annotation Edited</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual5" id="node-input-o_annotationEdited"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_annotationRemoved"><i></i> Annotation Removed</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual6" id="node-input-o_annotationRemoved"></input>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_spaceUpdated"><i></i> Space Updated</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual7" id="node-input-o_spaceUpdated"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_spaceDeleted"><i></i> Space Deleted</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual8" id="node-input-o_spaceDeleted"></input>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_spaceMemberAdded"><i></i> Member Added</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual9" id="node-input-o_spaceMemberAdded"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_spaceMemberRemoved"><i></i> Member Removed</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual10" id="node-input-o_spaceMemberRemoved"></input>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_reactionAdded"><i></i> Reaction Added</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual11" id="node-input-o_reactionAdded"></input>
                    </div>
                </td>
                <td>
                    <div class="form-row">
                        <label for="node-input-o_reactionRemoved"><i></i> Reaction Removed</label>
                        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="qual12" id="node-input-o_reactionRemoved"></input>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <hr/>
    <div class="form-row">
        <label for="node-input-noOwnAnnotations" style="width:200px"><i class="fa fa-cog"></i> Disallow Own Annotations</label>
        <input style="display: inline-block; width: auto; vertical-align: top;" type="checkbox" name="noOwnAnnotations" id="node-input-noOwnAnnotations"></input>
    </div>

    <div class="form-row">
        <label for="node-input-cacheLimit"><i class="fa fa-tag"></i> Cache Limit</span></label>
        <input type="text" id="node-input-cacheLimit" placeholder="enter a number">
    </div>
    <hr/>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">
		<h4>Tip</h4>
		<p>To see which message types are received by this webhook you can easily obeserve it by looking at the nodes status information.</p>
	</div>
</script>

<script type="text/x-red" data-help-name="wws-webhook">
    <p>Node to receive webhook events published by <a href="https://workspace.ibm.com">IBM Watson Workspace</a>.</p>
    <h3>Instructions</h3>
    <p>
        Read the <a href="https://developer.watsonwork.ibm.com/docs/apps/prepare-your-app-to-run" target="_blank">following instructions</a> provided by the Watson Work Developer Team.</br>
        This provides you with the ability to enter the required information for the node to work properly.<br/>
        <b>TIP:</b> Do not enable the webhook during the event registration, as you need to configure this node first.
    </p>
    <ol>
        <li>Select or create configure a workspace app</li>
        <li>Enter the Webhook Secret provided to you during the <a href="https://developer.watsonwork.ibm.com/apps" target="_blank">Watson Work App registration process.</a></li>
        <li>Check if Webhook URL matches with the one you entered during the Watson Work App event registration page.</li>
    </ol>
    <p>
        Once the workspace app and the webhook secret have been entered, you can deploy the flow with this configured node.</br>
        Now you can enable the webhook by clicking the <code>Enable</code> button on the event registration page.
    </p>

    <h3>Behavior</h3>
    <p>
        This node now exhibits some convenience features:
        <ul>
            <li>
                <h4>Output filtering</h4>
                <p>
                    When the <code>filterOutputs</code> checkbox is not selected, all processed events are returned in the <b>single output</b> provided by the node.
                </p>
                <p>
                    When the <code>filterOutputs</code> checkbox <b>is selected</b>, a new set of options is shown as displayed here:
                    <br/>
                    <img src="icons/node-red-contrib-wws/wws-webhook-filterOutput.png" />
                    <br/>
                    A set of several checkboxes is displayed: each checkbox corresponds to a possible <b>event type</b>. By selecting one or more of those checkboxes, 
                    the node will direct the output corresponding to the relevant <b>event type</b> to the output associated to it. In the following image you see the
                    appearence of the Webhook node once we have enabled the <code>filterOutputs</code> checkbox and selected the <b>event types</b> as shown in the previous 
                    image.
                    <br/>
                    <img src="icons/node-red-contrib-wws/wws-webhook-filterOutput-result.png" />
                    <br/>
                    In this way you can better control which processing to apply to any received event, according to its <b>event type</b>.
                    <br />
                    <b>Note :</b><br/>
                    If you modify the list of event types in the panel, it is likely that the order of the outputs for the Webhook node will change. So always verify that, 
                    after alering the list of event types that are filtered, the order of the outputs corresponds to what your processing requires.
                </p>
            </li>
            <li>
                <h4>Own Filtering</h4>
                <p>
                    By default, <code>message-created</code> events generated by the same IBM Watson Workspace application are <b>ignored</b> by the Webhook node.
                    <br />
                    In addition, when the <code>Disallow Own Annotations</code> checkbox is selected, Annotations that refer to a message generated by the same IBM 
                    Watson Workspace application are <b>also ignored</b> by the Webhook node.
                    <br/>
                    This would help preventing undesired behaviors (ripple effects) in certain situations. 
                </p>
            </li>
            <li>
                <h4>Attaching original message to Annotations and Reactions</h4>
                <p>
                    When an annotation is <b>created</b> or <b>edited</b>, it brings the id of the message to which such annotation refers to. <br />
                    The same happens when a reaction is <b>added</b> or <b>removed</b>. <br />
                    The node automatically retrieves the <b>original Message</b> associated with the annotation or reaction and places it in the <code>msg.wwsOriginalMessage</code> 
                    attribute. In this way, it becomes simpler for the developer to get the annotation/reaction <b>as well as</b> the message to which such annotation/reaction refers to.
                </p>
            </li>
            <li>
                <h4>Message Caching</h4>
                <p>
                    In order to minimize the impact of fetching the <b>original message</b> for each annotation or reaction, a <b>cache mechanism</b> has been implemented by the 
                    node. The cache works as a Round-Robin queue (the latest access message is the one which will be popped first from the queue). 
                    <br />
                    In this way, when a message is already in the cache, the node does not have to perform an additional GraphQL query to retrieve it. 
                    <br />
                    The default for the Cache is <b>5000</b> elements. This value can be modified using the node Configuration panel.
                </p>
        </ul>
    </p>

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>Hook Secret
            <span class="property-type">password</span>
        </dt>
        <dd>
            The Webhook secrete as described in the <a href="https://developer.watsonwork.ibm.com/docs/api-reference/webhooks">official documentation</a>. 
        </dd>

        <dt>Hook Path
            <span class="property-type">string</span>
        </dt>
        <dd>
            The Webhook path as described in the <a href="https://developer.watsonwork.ibm.com/docs/api-reference/webhooks">official documentation</a>. 
        </dd>

        <dt>Filter Outputs
            <span class="property-type">boolean</span>
        </dt>
        <dd>
            See the <b>Output filtering</b> information in the <b>Behavior Section</b> above
        </dd>

        <dt>Disallow Own Annotations
            <span class="property-type">boolean</span>
        </dt>
        <dd>
            See the <b>Output filtering</b> information in the <b>Behavior Section</b> above
        </dd>

        <dt>Cache Limit
            <span class="property-type">integer</span>
        </dt>
        <dd>
            See the <b>Message Caching</b> information in the <b>Behavior Section</b> above
        </dd>
                    
    </dl>
    
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">object | string</span>
        </dt>
        <dd>The webhook event received from Watson Work. Check the reference documentation, to understand and know the different event types.
            <br/>
            See the details section for an explanation of the content of the <b>payload</b> attribute for each event type.
        </dd>

        <dt>wwsSpaceId
            <span class="property-type">string</span>
        </dt>
        <dd>
            The space ID from which this Webhook Event has been received.
        </dd>

        <dt>wwsSpaceName
            <span class="property-type">string | undefined</span>
        </dt>
        <dd>
            The display name of the space generating the event. Depending on the event type this value may be present or not present.
        </dd>
    
        <dt>wwsMessageId
            <span class="property-type">string</span>
        </dt>
        <dd>
            The message ID - depending on the type of the event this is either the actual message OR the message to which this event refers to (e.g. annotations).
        </dd>

        <dt>wwsType
            <span class="property-type">enum</span>
        </dt>        
        <dd>
            The type of the event. See the <b>Details section</b> below for further information on available event types. 
        </dd>

        <dt>wwsEvent
            <span class="property-type">object</span>
        </dt>
        <dd>
            The raw, unparsed webhook event received from Watson Work. It simply represents the original event
        </dd>
    </dl>

    <h3>Details</h3>
    <p>
        Depending on the event type, different values will appear. Ideally a switch node should be added as the following node, to push the message according to the type.
        <br/>
        The following message types are supported.
    </p>
    <ul>
        <li><code>message-created</code>
            <p>
                This event is issued when an user (not an app) is posting a message to a space.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The text that was added to the space.
                    </dd>

                    <dt>wwsUserName
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The name of the user who createted the message
                    </dd>
            
                    <dt>wwsUserId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the user who createted the message
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><code>message-edited</code>
            <p>
                This event is issued when an user (not an app) is editing a message in a space.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The text that was modified in the space.
                    </dd>

                    <dt>wwsUserName
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The name of the user who edited the message
                    </dd>
            
                    <dt>wwsUserId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the user who edited the message
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><code>message-deleted</code>
            <p>
                This event is issued when an user (not an app) is deleting a message from a space.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the message that was deleted.
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><code>message-annotation-added</code>
            <p>
                This event is issued when a new Annotation is added to a message.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">object</span>
                    </dt>
                    <dd>
                        The JSON object representation of the original <b>annotationPayload</b> attribute returned by the event. The JSON parsing is a convenience for the 
                        developer.
                        <br />
                        If the <b>wwsAnnotationType</b> is <code>message-focus</code>, the payload is deeply parsed.
                    </dd>

                    <dt>wwsAnnotationService
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The name of the IBM Watson Workspace service which created the annotation.
                    </dd>
            
                    <dt>wwsAnnotationId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the Annotation
                    </dd>
            
                    <dt>wwsAnnotationType
                        <span class="property-type">enum</span>
                    </dt>
                    <dd>
                        See the <a href="https://developer.watsonwork.ibm.com/docs/annotations/">reference documentation</a> for a detailed description of each <b>Annotation Type</b>.
                    </dd>
            
                    <dt>wwsActionId
                        <span class="property-type">string | undefined</span>
                    </dt>
                    <dd>
                        if <code>wwsAnnotationType === "actionSelected"</code>, the <b>wwsActionId</b> contains the name of the action.
                        <br />
                        In all other situations it is undefined.
                    </dd>
    
                    <dt>wwsOriginalMessage
                        <span class="property-type">object</span>
                    </dt>
                    <dd>
                        The JSON content of the message to which the annotation refers to (<b>msg.wwsMessageId</b>). 
                        <br />
                        In case the annotation brings a <code>referralMessageId</code> information, the node uses the <b>referralMessageId</b> instead of the <b>messageId</b> attribute to
                        retrieve the content of the message to which the annotation refers to. This is particularly useful for Annotations of type <code>actionSelected</code>; in this
                        case, the <b>referrallMessageId</b> brings all the required information of the original message, <b>including the FOCUS annotation</b> which is very useful
                        when you need to retrieve the <b>lens</b> associated with the selected action (the <b>lens</b> is actually found in the array of annotations associated 
                        with the original message)
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><code>message-annotation-edited</code>
            <p>
                This event is issued when a new Annotation is Edited.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">object</span>
                    </dt>
                    <dd>
                        The JSON object representation of the original <b>annotationPayload</b> attribute returned by the event. The JSON parsing is a convenience for the 
                        developer.
                        <br />
                        If the <b>wwsAnnotationType</b> is <code>message-focus</code>, the payload is deeply parsed.
                    </dd>

                    <dt>wwsAnnotationService
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The name of the IBM Watson Workspace service which created the annotation.
                    </dd>
            
                    <dt>wwsAnnotationId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the Annotation
                    </dd>
            
                    <dt>wwsAnnotationType
                        <span class="property-type">enum</span>
                    </dt>
                    <dd>
                        See the <a href="https://developer.watsonwork.ibm.com/docs/annotations/">reference documentation</a> for a detailed description of each <b>Annotation Type</b>.
                    </dd>

                    <dt>wwsOriginalMessage
                        <span class="property-type">object</span>
                    </dt>
                    <dd>
                        The JSON content of the message to which the annotation refers to (<b>msg.wwsMessageId</b>). 
                        <br />
                        In case the annotation brings a <code>referralMessageId</code> information, the node uses the <b>referralMessageId</b> instead of the <b>messageId</b> attribute to
                        retrieve the content of the message to which the annotation refers to. This is particularly useful for Annotations of type <code>actionSelected</code>; in this
                        case, the <b>referrallMessageId</b> brings all the required information of the original message, <b>including the FOCUS annotation</b> which is very useful
                        when you need to retrieve the <b>lens</b> associated with the selected action (the <b>lens</b> is actually found in the array of annotations associated 
                        with the original message)
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><code>message-annotation-removed</code>
        </li>
        <li><code>space-members-added</code>
            <p>
                This event is issued when new Members or Applications are added to a space.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">array of IDs</span>
                    </dt>
                    <dd>
                        An array where each element represents the ID of the Members (or Application) added to the space.
                        <br />
                        <b>Note : </b> a <code>space-updated</code> event is also triggered when you add a member or an application. This event simply provides the ID of who 
                        updated the space, but unfortunately there is no means to correlate it to the <code>space-members-added</code> event.
                    </dd>

                    <dt>wwsSpaceName
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The name of the space
                    </dd>
            
                    <dt>wwsSpaceId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the space
                    </dd>
            
                    <dt>wwsCause
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        In case the Application itself (the one whose credentials support the current Webhook) is added, then this attribute exists and has a value 
                        of <b>app-removed</b>.
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><code>space-members-removed</code>
            <p>
                This event is issued when new Members or Applications are removed from a space.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>payload
                        <span class="property-type">array of IDs</span>
                    </dt>
                    <dd>
                        An array where each element represents the ID of the Members (or Application) removed from the space.
                        <br />
                        <b>Note : </b> a <code>space-updated</code> event is also triggered when you remove a member or an application. This event simply provides the ID of who 
                        updated the space, but unfortunately there is no means to correlate it to the <code>space-members-removed</code> event.
                    </dd>

                    <dt>wwsSpaceName
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The name of the space
                    </dd>
            
                    <dt>wwsSpaceId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The ID of the space
                    </dd>
            
                    <dt>wwsCause
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        In case the Application itself (the one whose credentials support the current Webhook) is removed, then this attribute exists and has a value 
                        of <b>app-removed</b>.
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><b>NEW</b> <code>reaction-added</code>
            <p>
                This event is issued when someone reacts on a message.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>wwsReactionType
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The type of the reactions
                    </dd>

                    <dt>payload
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The reaction added to the message. Normally this is an emoticon. 
                    </dd>

                    <dt>wwsUserId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The user ID of the person who reacted
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><b>NEW</b> <code>reaction-removed</code>
            <p>
                This event is issued when someone removes hier own previous reaction on a message.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>wwsReactionType
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The type of the reactions
                    </dd>

                    <dt>payload
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The reaction removed from the message. Normally this is an emoticon. 
                    </dd>

                    <dt>wwsUserId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The user ID of the person who reacted
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><b>NEW</b> <code>space-updated</code>
            <p>
                This event is issued when new a space is updated.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>wwsUpdateCause
                        <span class="property-type">enum</span>
                    </dt>
                    <dd>
                        The following values are currently supported:
                        <ul>
                            <li><b>property-change</b> : when a property of the space (based on a template is modified</li>
                            <li><b>description-change</b> : When the description of the space is changed</li>
                            <li><b>title-change</b> : When the title of the space is changed</li>
                            <li><b>status-change</b> : When the workflow status of the space (based on a template is changed </li>
                            <li>b>other</b> : all other situations</li>
                        </ul>
                        The following <b>payload</b> output attribute will contain different information according to the value of the <b>wwsUpdateCause</b>.
                    </dd>

                    <dt>payload
                        <span class="property-type">string | object | undefined </span>
                    </dt>
                    <dd>
                        According to the value of the <b>wwsUpdateCause</b> attribute, the <b>payload</b> can contain the following information:
                        <ul>
                            <li><b>property-change</b> : an object whose <code>propertyId</code> attribute is t<b>the value</b> of the changed property.
                            <br/>
                            Note that you should read <b>propertyId</b> as the ID of the changed property and not as a string literal!
                            </li>
                            <li><b>description-change</b> : a string containing the new Space description</li>
                            <li><b>title-change</b> : a string containing the new space Title</li>
                            <li><b>status-change</b> : an object whose <code>statusValue</code> attribute is t<b>the ID</b> of the new status</li>
                            <li>b>other</b> : undefined</li>
                        </ul>
                    </dd>

                    <dt>wwsUserId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The user ID of the person who performed the change
                    </dd>
                </dl>                    
            </p>            
        </li>
        <li><b>NEW</b> <code>space-deleted</code>
            <p>
                This event is issued when new a space is deleted.
            </p>
            <p>
                In addition to the output information described in the <b>Outputs</b> section, the following properties are added to the output message:
                <dl class="message-properties">
                    <dt>wwsUserId
                        <span class="property-type">string</span>
                    </dt>
                    <dd>
                        The user ID of the person who deleted the space
                    </dd>
                </dl>                    
            </p>            
        </li>       
    </ul>


    <h3>References</h3>
    <ul>
        <li><a href="https://developer.watsonwork.ibm.com/docs/api-reference/" target="_blank">Watson Work API</a> - Reference Documentation</li>
        <li><a href="https://developer.watsonwork.ibm.com/docs/api-reference/webhooks" target="_blank">Webhooks</a> - Reference Documentation for Webhooks</li>
        <li><a href="https://developer.watsonwork.ibm.com/docs/get-started/what-can-you-build" target="_blank">Getting Started</a> - Guide to be used as starting point</li>
        <li>TODO: <a>GitHub</a> - the nodes github repository</li>
    </ul>

</script>
